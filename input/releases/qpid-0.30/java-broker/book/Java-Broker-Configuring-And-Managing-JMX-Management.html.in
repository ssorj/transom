<div class="docbook"><div class="navheader"><table summary="Navigation header" width="100%"><tr><th align="center" colspan="3">5.3.&#160;JMX Management</th></tr><tr><td align="left" width="20%"><a accesskey="p" href="Java-Broker-Configuring-And-Managing-HTTP-Management.html">Prev</a>&#160;</td><th align="center" width="60%">Chapter&#160;5.&#160;Configuring And Managing</th><td align="right" width="20%">&#160;<a accesskey="n" href="Java-Broker-Configuring-And-Managing-Other-Tooling.html">Next</a></td></tr></table><hr /></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="Java-Broker-Configuring-And-Managing-JMX-Management"></a>5.3.&#160;JMX Management</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Java-Broker-Configuring-And-Managing-JMX-Management-Introduction"></a>5.3.1.&#160;Introduction</h3></div></div></div><p>The JMX management plugin provides a series of managed beans (MBeans) allowing you to
            control and monitor the Broker via an industry compliant interface. This provides a
            convenient intergration point for a variety of Infrastructure Monitoring Solutions,
            tools such as Jconsole and VisualVM, as well as custom Java programs and scripts.</p><p>The following sections describe how to connect to JMX, the configuration of the JMX
            plugin covering topis including securing with SSL, programmatically interacting with
            Qpid MBeans and finally a summary of all the MBeans made available from by the
            plugin.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>For new development work, the reader is directed towards the strategic <a class="link" href="Java-Broker-Configuring-And-Managing-HTTP-Management.html#Java-Broker-Configuring-And-Managing-Web-Console" title="5.2.2.&#160;Web Management Console">Web Management
                    Console</a> and the <a class="link" href="Java-Broker-Configuring-And-Managing-HTTP-Management.html#Java-Broker-Configuring-And-Managing-REST-API" title="5.2.4.&#160;REST API">REST API</a>. Use the
                Web/REST interfaces in preference to JMX whenever possible. The JMX interface may be
                withdrawn in a future release.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Java-Broker-Configuring-And-Managing-JMX-Management-Plugin-DefaultConfiguration"></a>5.3.2.&#160;Default Configuration</h3></div></div></div><p>By default, the Broker is shipped with JMX enabled.</p><p>The RMI registry port runs on port <code class="literal">8999</code> and the JMX connector on
            port <code class="literal">9099</code>. The connector is not SSL protected. Qpid will use the
                <a class="ulink" href="http://docs.oracle.com/javase/6/docs/api/java/lang/management/ManagementFactory.html#getPlatformMBeanServer()" target="_top">Platform MBeanServer</a>.</p><p>To change these settings, use the <a class="link" href="Java-Broker-Configuring-And-Managing-HTTP-Management.html#Java-Broker-Configuring-And-Managing-Web-Console" title="5.2.2.&#160;Web Management Console">Web Management
                interface</a>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Java-Broker-Configuring-And-Managing-JMX-Management-Plugin-ConnectingToJMX"></a>5.3.3.&#160;Connecting to JMX</h3></div></div></div><p>The following example uses Jconsole to illustrates how to connect to JMX and assume
            the defaults described above. Jconsole is a management tool that comes with the JDK. It
            provides a very simple view of the MBeans, but requires no special configuration to be
            used with Qpid.</p><p>For full details of Jconsole itself refer to Oracle's <a class="ulink" href="http://java.sun.com/javase/6/docs/technotes/guides/management/jconsole.html" target="_top">JConsole Guide</a>.</p><p>Jconsole can be used to connect to local or remote Java processes. On startup, it
            presents a list of all the Java processes running on the local host and also allows you
            to specify a service url to connect to a Java process running on a remote host.</p><p>To start Jconsole on the command line, type:</p><pre class="programlisting">jconsole</pre><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="Java-Broker-Configuring-And-Managing-JMX-Management-Plugin-ConnectingToJMX-Local"></a>5.3.3.1.&#160;Local</h4></div></div></div><p>To connect to a Broker running locally, simply select the process from the list.
                You can identify the Broker by looking for its classname
                    <code class="literal">org.apache.qpid.server.Main</code>.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="Java-Broker-Configuring-And-Managing-JMX-Management-Plugin-ConnectingToJMX-Remote"></a>5.3.3.2.&#160;Remote</h4></div></div></div><p>To connect to a broker running remotely, provide the hostname and port number of
                the <span class="emphasis"><em>RMI registry port</em></span> (e.g. <code class="literal">hostname:8999</code>)
                and a valid username and password.</p><p>You can also provide a service url in the form
                    <code class="literal">service:jmx:rmi:///jndi/rmi://hostname:8999/jmxrmi</code></p><div class="figure"><a id="idm140304441833520"></a><p class="title"><strong>Figure&#160;5.1.&#160;Making a remote JMX connection to a Broker using jconsole</strong></p><div class="figure-contents"><div><img alt="Making a remote JMX connection to a Broker using jconsole" src="images/JMX-Connect-Remote.png" /></div></div></div><br class="figure-break" /></div><p>Once you are connected expand the tree of nodes marked
                <code class="literal">org.apache.qpid</code> to begin to interact with the Qpid MBeans.</p><div class="figure"><a id="idm140304441830864"></a><p class="title"><strong>Figure&#160;5.2.&#160;Qpid MBean hierarchy</strong></p><div class="figure-contents"><div><img alt="Qpid MBean hierarchy" src="images/JMX-Connect-MBeans.png" /></div></div></div><br class="figure-break" /><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="Java-Broker-Configuring-And-Managing-JMX-Management-Plugin-ConnectingToJMX-SSL"></a>5.3.3.3.&#160;Connecting to a remote Broker protected by SSL</h4></div></div></div><p>If you are connecting to a remote Broker whose JMX connector port has been secured
                with SSL certificate signed by a private CA (or a self-signed certificate), you will
                need to pass a trust store and trust store password to Jconsole. If this is
                required, start jconsole with the following options:</p><pre class="programlisting">jconsole -J-Djavax.net.ssl.trustStore=jmxtruststore.jks -J-Djavax.net.ssl.trustStorePassword=password</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Java-Broker-Configuring-And-Managing-JMX-Example-Client"></a>5.3.4.&#160;Example JMX Client</h3></div></div></div><p>The following java snippet illustrates a JMX client that connects to Qpid over JMX
            passing a userid and password, looks up the <a class="ulink" href="http://svn.apache.org/viewvc/qpid/trunk/qpid/java/management/common/src/main/java/org/apache/qpid/management/common/mbeans/ManagedBroker.java?view=co" target="_top">ManagedBroker</a> object corresponding to the <code class="literal">myvhost</code>
            virtualhost, then invokes a method on the virtualhost to create a new queue.</p><p>A full introduction to custom JMX clients is beyond the scope of this book. For this
            the reader is directed toward Oracle's <a class="ulink" href="http://docs.oracle.com/javase/tutorial/jmx/" target="_top">JMX
                tutorial.</a></p><div class="example"><a id="Java-Broker-Configuring-And-Managing-JMX-Example-Client-Code"></a><p class="title"><strong>Example&#160;5.4.&#160;JMX Client illustrating the creation of a new queue</strong></p><div class="example-contents"><pre class="programlisting">
Map&lt;String, Object&lt; environment = new HashMap&lt;String, Object&gt;();
environment.put(JMXConnector.CREDENTIALS, new String[] {"admin","password"});
// Connect to service
JMXServiceURL url =  new JMXServiceURL("service:jmx:rmi:///jndi/rmi://localhost:8999/jmxrmi");
JMXConnector jmxConnector = JMXConnectorFactory.connect(url, environment);
MBeanServerConnection mbsc =  jmxConnector.getMBeanServerConnection();
// Object name for ManagedBroker mbean for virtualhost myvhost
ObjectName objectName = new ObjectName("org.apache.qpid:type=VirtualHost.VirtualHostManager,VirtualHost=\"myvhost\"");
// Get the ManagedBroker object
ManagedBroker managedBroker = JMX.newMBeanProxy(mbsc, objectName, ManagedBroker.class);;

// Create the queue named "myqueue"
managedBroker.createNewQueue("myqueue", null, true);</pre></div></div><br class="example-break" /><p>The Qpid classes required for a custom JMX client are included in the
                <code class="literal">qpid-management-common</code> artefact.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Java-Broker-Configuring-And-Managing-JMX-Management-MBeans"></a>5.3.5.&#160;The MBeans</h3></div></div></div><p>The following table summarises the available MBeans. The MBeans are self-describing:
            each attribute and operation carry a description describing their purpose. This
            description is visible when using tools such Jconsole. They are also available on
            Management interfaces themselves (linked below).</p><div class="table"><a id="idm140304441816768"></a><p class="title"><strong>Table&#160;5.3.&#160;Qpid Broker MBeans</strong></p><div class="table-contents"><table border="1" summary="Qpid Broker MBeans"><colgroup><col /><col /></colgroup><thead><tr><th>Management Interface</th><th>Object Name</th></tr></thead><tbody><tr><td rowspan="2">
                            <p>
                                <a class="ulink" href="http://svn.apache.org/viewvc/qpid/trunk/qpid/java/management/common/src/main/java/org/apache/qpid/management/common/mbeans/ManagedBroker.java?view=co" target="_top">ManagedBroker</a>
                            </p>
                        </td><td>
                            <p>
                                <code class="literal">org.apache.qpid:type=VirtualHost.VirtualHostManager,VirtualHost="<em class="replaceable"><code>virtualhostname</code></em>"</code>
                            </p>
                        </td></tr><tr><td>
                            <p>MBean corresponding to the named virtualhost. Allows operations
                                such as the creation/deletion of queues and exchanges on that
                                virtualhost and virtualhost levell statistics.</p>
                        </td></tr><tr><td rowspan="2">
                            <p>
                                <a class="ulink" href="http://svn.apache.org/viewvc/qpid/trunk/qpid/java/management/common/src/main/java/org/apache/qpid/management/common/mbeans/ManagedQueue.java?view=co" target="_top">ManagedQueue</a>
                            </p>
                        </td><td>
                            <p>
                                <code class="literal">org.apache.qpid:type=VirtualHost.Queue,VirtualHost="<em class="replaceable"><code>virtualhostname</code></em>",name="<em class="replaceable"><code>queuename</code></em>"</code>
                            </p>
                        </td></tr><tr><td>
                            <p>MBean corresponding to the named queue on the given virtualhost.
                                Allows queue management operations such as view message, move
                                message and clear queue. Exposes attributes such as queue depth and
                                durability.</p>
                        </td></tr><tr><td rowspan="2">
                            <p>
                                <a class="ulink" href="http://svn.apache.org/viewvc/qpid/trunk/qpid/java/management/common/src/main/java/org/apache/qpid/management/common/mbeans/ManagedExchange.java?view=co" target="_top">ManagedExchange</a>
                            </p>
                        </td><td>
                            <p>
                                <code class="literal">org.apache.qpid:type=VirtualHost.Exchange,VirtualHost="<em class="replaceable"><code>virtualhostname</code></em>",name="<em class="replaceable"><code>amq.direct</code></em>",ExchangeType=<em class="replaceable"><code>type</code></em></code>
                            </p>
                        </td></tr><tr><td>
                            <p>MBean corresponding to the named exchange on the given
                                virtualhost. Allows exchange management operations such as the
                                creation and removal of bindings. The supported exchange types are
                                exposed by the <code class="literal">exchangeTypes</code> attribute of the
                                virtualhost.</p>
                        </td></tr><tr><td rowspan="2">
                            <p>
                                <a class="ulink" href="http://svn.apache.org/viewvc/qpid/trunk/qpid/java/management/common/src/main/java/org/apache/qpid/management/common/mbeans/ManagedConnection.java?view=co" target="_top">ManagedConnection</a>
                            </p>
                        </td><td>
                            <p>
                                <code class="literal">org.apache.qpid:type=VirtualHost.Connection,VirtualHost="<em class="replaceable"><code>virtualhostname</code></em>",name="<em class="replaceable"><code>/peerid:ephemeralport</code></em>"</code>
                            </p>
                        </td></tr><tr><td>
                            <p>MBean representing a active AMQP connection to the named virtual
                                host. Name is formed from the IP and ephemeral port of the peer.
                                Attributes include the client version and connection level
                                statistics.</p>
                        </td></tr><tr><td rowspan="2">
                            <p>
                                <a class="ulink" href="http://svn.apache.org/viewvc/qpid/trunk/qpid/java/management/common/src/main/java/org/apache/qpid/management/common/mbeans/UserManagement.java?view=co" target="_top">UserManagement</a>
                            </p>
                        </td><td>
                            <p>
                                <code class="literal">org.apache.qpid:type=UserManagement,name="UserManagement-<em class="replaceable"><code>authentication
                                        manager name</code></em>"</code>
                            </p>
                        </td></tr><tr><td>
                            <p>When using <a class="link" href="Java-Broker-Security.html#Java-Broker-Security-PlainPasswordFile-Provider" title="11.1.5.&#160;Plain Password File">Plain
                                    password provider</a> or <a class="link" href="Java-Broker-Security.html#Java-Broker-Security-Base64MD5PasswordFile-Provider" title="11.1.6.&#160;Base64MD5 Password File">Base 64 MD5 password provider</a>, permits user operations
                                such creation and deletion of users. and password changes.</p>
                        </td></tr><tr><td rowspan="2">
                            <p>
                                <a class="ulink" href="http://svn.apache.org/viewvc/qpid/trunk/qpid/java/management/common/src/main/java/org/apache/qpid/management/common/mbeans/ServerInformation.java?view=co" target="_top">ServerInformation</a>
                            </p>
                        </td><td>
                            <p>
                                <code class="literal">org.apache.qpid:type=ServerInformation,name=ServerInformation</code>
                            </p>
                        </td></tr><tr><td>
                            <p>Exposes broker wide statistics, product version number and JMX
                                management API version number.</p>
                        </td></tr><tr><td rowspan="2">
                            <p>
                                <a class="ulink" href="http://svn.apache.org/viewvc/qpid/trunk/qpid/java/management/common/src/main/java/org/apache/qpid/management/common/mbeans/LoggingManagement.java?view=co" target="_top">LoggingManagement</a>
                            </p>
                        </td><td>
                            <p>
                                <code class="literal">org.apache.qpid:type=LoggingManagement,name=LoggingManagement</code>
                            </p>
                        </td></tr><tr><td>
                            <p>MBean permitting control of the Broker's logging. Exposes
                                operations allow the logging level to be controlled at runtime
                                (without restarting the Broker) and others that allow changes to be
                                written back to the log4j.xml logging configuration file, or the
                                contents of the log4.xml file to be re-read at runtime.</p>
                        </td></tr></tbody></table></div></div><br class="table-break" /></div></div><div class="navfooter"><hr /><table summary="Navigation footer" width="100%"><tr><td align="left" width="40%"><a accesskey="p" href="Java-Broker-Configuring-And-Managing-HTTP-Management.html">Prev</a>&#160;</td><td align="center" width="20%"><a accesskey="u" href="Java-Broker-Configuring-And-Managing.html">Up</a></td><td align="right" width="40%">&#160;<a accesskey="n" href="Java-Broker-Configuring-And-Managing-Other-Tooling.html">Next</a></td></tr><tr><td align="left" valign="top" width="40%">5.2.&#160;HTTP Management&#160;</td><td align="center" width="20%"><a accesskey="h" href="index.html">Home</a></td><td align="right" valign="top" width="40%">&#160;5.4.&#160;Other Tooling</td></tr></table></div></div>